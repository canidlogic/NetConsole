# NAME

netc\_createdb.pl - Create a new remote NetConsole database with the
appropriate structure.

# SYNOPSIS

    ./netc_createdb.pl path/to/db.sqlite

# DESCRIPTION

This script is used to create a new, empty database for use in remote
NetConsole servers, with the appropriate structure but no records.

The database must not already exist or a fatal error occurs.

The SQL string embedded in this script contains the complete database
structure.  The following subsections describe the function of each
table within the database.

## usr table

The `usr` table stores information about the registered users.  Each
user must have a unique `usrname` that identifies them.  The `usrpswd`
stores a hash of the user's password, in the format generated by the
`Crypt::Bcrypt` library.  The `usradmin` is 1 if the user is an
administrator, or 0 if the user is a regular user.

## ssn table

The `ssn` table stores information about active sessions.

Each session is randomly assigned a unique `ssncode` to uniquely
identify it.  A cryptographically secure random number generator must be
used.  The code must be in range \[0, 16777215\].  This allows the code to
be stored in exactly four base-64 digits.

Each session also has a timestamp `ssntime` which counts the number of
_minutes_ that have elapsed since midnight GMT at the start of January
1, 1970.  This timestamp is updated to the current time each time a
transaction is performed in the session.  Sessions whose timestamps are
older than a certain number of minutes can be automatically closed.
(The specific number of minutes before sessions are closed is not
defined within the database.)

The `ssnkey` stores sixteen randomly generated base-64 digits that were
generated with a cryptographically secure random number generator.  This
is used as a secret key to sign HMAC-MD5 digests that are used to
authenticate that the client has tampered with context.  Each time a
context is validated with a key, the key is immediately changed to a
different random value.

Finally, each session stores a foreign key into the `usr` table to
determine which user the session belongs to.

## var table

The `var` table stores configuration variables.  The specific
configuration variables are not defined by NetConsole.  This is instead
intended for use by specific remote NetConsole server implementations to
store their own configurations.

This table is a simple string key/value map where the unique keys are
the `varname` column and the string values are the `varvalue` column.

# AUTHOR

Noah Johnson, `noah.johnson@loupmail.com`

# COPYRIGHT AND LICENSE

Copyright (C) 2022 Multimedia Data Technology Inc.

MIT License:

Permission is hereby granted, free of charge, to any person obtaining a
copy of this software and associated documentation files
(the "Software"), to deal in the Software without restriction, including
without limitation the rights to use, copy, modify, merge, publish,
distribute, sublicense, and/or sell copies of the Software, and to
permit persons to whom the Software is furnished to do so, subject to
the following conditions:

The above copyright notice and this permission notice shall be included
in all copies or substantial portions of the Software.

THE SOFTWARE IS PROVIDED "AS IS", WITHOUT WARRANTY OF ANY KIND, EXPRESS
OR IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF
MERCHANTABILITY, FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT.
IN NO EVENT SHALL THE AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY
CLAIM, DAMAGES OR OTHER LIABILITY, WHETHER IN AN ACTION OF CONTRACT,
TORT OR OTHERWISE, ARISING FROM, OUT OF OR IN CONNECTION WITH THE
SOFTWARE OR THE USE OR OTHER DEALINGS IN THE SOFTWARE.
